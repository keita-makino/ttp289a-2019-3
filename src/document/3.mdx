# 3.

In this section, we have confirmed that the BS model has violated the IIA assumption. Given such result, in this section, we will make three new nested logit models.

In the nested logit model, there is a "group" of alternatives in the root level of multinomial logit model. For example, we assume that each participant will choose automobile or public transit. Then, in the nested layer, they will choose either rapid transit or train to make the final decision.

Similar in the way selecting the variable to truncate in the last IIA testing section, here we have three options of an alternative to be included in the root layer (i.e., rapid-transit, train or auto. The other two which are not selected will become the "group" and be in the nested layer).

The first model we can create has rapid-transit in the root layer, and has train and automobile in the nested layer.

<img src={require('../data/image2.png')} width={'60%'} />

**Figure 3.1. Nest structure (el in root level)**

We can justify this structure with an assumption that whether the mode can handle long-distance travel or not is the most importance factor to narrow down the choices for the individual. With this criteria, rapid-transit, which usually serves only within city central, will be clearly distinguished from the others.

The next structure is to isolate train from the other two. This structure assumes that people most evaluate the factor whether there is a frequent service (rapid-transit) or general availability (automobile).

<img src={require('../data/image3.png')} width={'60%'} />

**Figure 3.2. Nest structure (train in root level)**

The last structure separates automobile from the rapid transit and train. Under this model, people would first choose if they like to use public transit or private mode.

<img src={require('../data/image4.png')} width={'60%'} />

**Figure 3.3. Nest structure (auto in root level)**

We name the nested models with these structure respectively NE, NT, and NA model. The following tables shows the details of the nested models. Note that, the function `apollo_nl` in R package `apollo` uses utility maximization nested logit (UMNL) model so that the computation of utility function is done according to the exact strcture shown in the images above.

**Table 6.1. NE Model (N=114)**

| Variable               | Estimate                    | Std. Error             | t-Sta.                      |
| ---------------------- | --------------------------- | ---------------------- | --------------------------- |
| asc_el                 | 0.521                       | 0.489                  | 1.047                       |
| asc_train              | -0.821                      | 0.716                  | -1.147                      |
| asc_auto               | (base)                      | -                      | -                           |
| General Service        | 1.134                       | 0.258                  | 3.169 \*\*                  |
| Lack of Travel Stress  | 1.156                       | 0.322                  | 3.591 \*\*                  |
| Travel Time            | -0.054                      | 0.019                  | -2.772 \*\*                 |
| $\Theta_{(Group)}$     | 1.139                       | 0.351                  | -3.247 \*\*                 |
| $\mathcal{L}$: -61.959 | $\mathcal{L}(EL)$: -125.242 | $\rho^2_{(EL)}$: 0.505 | Adj. $\rho^2_{(EL)}$: 0.457 |

**Table 6.2. NT Model (N=114)**

| Variable               | Estimate                    | Std. Error             | t-Sta.                      |
| ---------------------- | --------------------------- | ---------------------- | --------------------------- |
| asc_el                 | 0.640                       | 0.572                  | 1.120                       |
| asc_train              | -0.622                      | 0.775                  | -0.802                      |
| asc_auto               | (base)                      | -                      | -                           |
| General Service        | 1.243                       | 0.415                  | 2.995 \*\*                  |
| Lack of Travel Stress  | 1.232                       | 0.354                  | 3.477 \*\*                  |
| Travel Time            | -0.064                      | 0.037                  | -2.417 \*\*                 |
| $\Theta_{(Group)}$     | 1.299                       | 0.410                  | -3.166 \*\*                 |
| $\mathcal{L}$: -61.710 | $\mathcal{L}(EL)$: -125.242 | $\rho^2_{(EL)}$: 0.507 | Adj. $\rho^2_{(EL)}$: 0.459 |

**Table 6.3. NA Model (N=114)**

| Variable               | Estimate                    | Std. Error             | t-Sta.                      |
| ---------------------- | --------------------------- | ---------------------- | --------------------------- |
| asc_el                 | 0.631                       | 0.363                  | 1.737 \*                    |
| asc_train              | -0.209                      | 0.572                  | -0.366                      |
| asc_auto               | (base)                      | -                      | -                           |
| General Service        | 0.906                       | 0.271                  | 3.347 \*\*                  |
| Lack of Travel Stress  | 0.832                       | 0.253                  | 3.293 \*\*                  |
| Travel Time            | -0.050                      | 0.014                  | -3.476 \*\*                 |
| $\Theta_{(Group)}$     | 0.550                       | 0.192                  | 2.862 \*\*                  |
| $\mathcal{L}$: -60.633 | $\mathcal{L}(EL)$: -125.242 | $\rho^2_{(EL)}$: 0.516 | Adj. $\rho^2_{(EL)}$: 0.468 |

Clearly, the first two models have a fatal invalidity in the estimates. From theoretical derivation, the inclusive value for the nested layer $\Theta_{(Group)}$ cannot exceed 1 since the following value must represents the correlation between the error terms of the alternatives in the nested layer.

$$
0 \le Corr[\epsilon(Group) + \epsilon(a1), \epsilon(Group) + \epsilon(a2)] = 1 - \Theta_{(Group)}^2 \le 1
$$

However, it does in the first two (NE, NT) models where either rapid transit or train is placed in the root layer. Given this result, we argue only the NA model later in this section.

Looking at the outcome of the NA model, all the variables except for asc_train have become significant in the model. Comparing the coefficients between those in BS model, the order of generic variables are not largely different, and they keep the same level of confidence level in the significance. One noticeable difference would be asc_el, which has become a significant variable in the RA model and has a larger magnitude. However, note that this is an UMNL model and the arc elasticity cannot be compared in the same manner to that in the BS model.

The inclusive value $\Theta_{(Group)}$ is determined as 0.550, which indicates that the correlation between error term of rapid-transit mode and train mode is:

$$
Corr[\epsilon(Group) + \epsilon(el), \epsilon(Group) + \epsilon(train)] = 1 - \Theta_{(Group)}^2 = 1 - 0.550^2 = 0.698
$$

This indicates that there is a strong correlation between the "public transit" modes.

To further test the validity of using nested logit model over multinomial logit model, we can first conduct a t-test to the inclusive parameter. If this value is equal to 1, the correlation between the error terms become 0 and thus we did not need to use the nested structure. The hypothesis should look as this:

$$
H_0: \Theta_{(Group)} = 1
$$

If the null hypothesis is true the statistic $\displaystyle T = \frac{\Theta_{(Group)} - 1}{s.e.(\Theta_{(Group)})}$ will follow a normal distribution. Note that we approximates t-distribution to normal distribution. Here we cannot use the t-statistic shown in the table above, because it tests whether the inclusive parameter is zero or not. The statistic in this case is:

$$
\frac{\Theta_{(Group)} - 1}{s.e.(\Theta_{(Group)})} = \frac{-0.450}{0.192} = -2.344
$$

The p-value of the statistic is:

$$
1 - 2 \times \int_{0}^{|T|} N(0,1) dx = 1 - 2 \times \int_{0}^{2.344} N(0,1) dx = 1.908 \times 10^{-2} \text{ **}
$$

Therefore, we can reject the null hypothesis and conclude that the inclusive parameter is not 1, which confirms the validity of the use of a nested model.

Also, we can conduct a $\chi^2$ test as we did to BS and MS models in section 1. Let the statistic be $L = -2(\mathcal{L}^R - \mathcal{L}^U)$, then we can make a hypothesis:

$$
H_0: \text{The performance of NA model is not significantly better than that of BS model} \Rightarrow L=0
$$

If the null hypothesis is true, $L$ will follow a chi-square distribution $\chi^2(d.f.=1)$.The p-value for this test is:

$$
1 - \int_{-\infty}^{L} \chi^2(x,1) dx = 1 - \int_{-\infty}^{-2(-62.048 + 60.633)} \chi^2(x,1) dx = 1 - \int_{-\infty}^{2.830} \chi^2(x,1) dx = 9.252 \times 10^{-2} \text{ *}
$$

Consequently, we can reject the null hypothesis with 90% confidence level and assess that the use of nested logit model have certainly improved the overall performance. The confidence level of the two test we conducted in above were somehow different. It is because the two tests measures different aspect of the usage of nested logit model. The first test validates the correctness of usage of nested logit model, while the latter examines the outcome of nested logit model. Given the result above, we can be more than 95% confident that the multinomial logit model is inappropriate (= nested model should be applied) and 90% confident that the new nested logit model bring a better performance over the multinomial logit model.
